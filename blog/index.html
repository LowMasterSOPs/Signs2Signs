<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Blog | Signs2Signs</title>
  <link rel="stylesheet" href="../style.css">

  <style>
    main { max-width: 1000px; margin: 0 auto; padding: 40px 20px; }
    .blog-header { text-align: center; margin-bottom: 30px; }
    .filters { display:flex; gap:10px; justify-content:center; margin:20px 0; flex-wrap:wrap; }
    .filters button { padding:8px 14px; border:0; border-radius:20px; cursor:pointer; font-weight:600; }
    .filters button.active { background:var(--accent); color:#111; }
    .tags { text-align:center; margin: 20px 0; }
    .tags button { margin:4px; padding:6px 12px; border:1px solid var(--accent); background:none; color:var(--accent); border-radius:14px; cursor:pointer; font-size:14px; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:24px; }
    .post-card { background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,.12); border-radius:16px; overflow:hidden; display:flex; flex-direction:column; }
    .post-card img { width:100%; height:180px; object-fit:cover; }
    .post-card .content { padding:16px; flex:1; display:flex; flex-direction:column; }
    .post-card h3 { margin:0 0 8px; font-size:18px; }
    .post-card p { flex:1; color:#cbd5e1; font-size:14px; margin:0 0 12px; }
    .meta { font-size:12px; color:#9ca3af; }
  </style>
</head>
<body>

<div id="header"></div>

<main>
  <div class="blog-header">
    <h1>Signs2Signs Blog</h1>
    <p class="muted">Latest tips, projects & updates from the workshop</p>
  </div>

  <!-- Sorting filters -->
  <div class="filters">
    <button data-sort="new" class="active">New</button>
    <button data-sort="views">Top Viewed</button>
    <button data-sort="likes">Most Liked</button>
  </div>

  <!-- Tag filters -->
  <div class="tags" id="tagFilters"></div>

  <!-- Posts grid -->
  <div class="grid" id="postsGrid"></div>
</main>

<div id="footer"></div>

<script type="module">
  import { fetchPosts, fetchTags } from './blog.js';

  const grid = document.getElementById('postsGrid');
  const tagFilters = document.getElementById('tagFilters');
  const filterBtns = document.querySelectorAll('.filters button');
  let currentSort = 'new';
  let currentTag = null;

  async function loadPosts(){
    grid.innerHTML = '<p>Loading...</p>';
    const { data } = await fetchPosts({ sort: currentSort, tag: currentTag });
    if(!data || data.length===0){ grid.innerHTML = '<p>No posts yet.</p>'; return; }
    grid.innerHTML = data.map(p=>`
      <div class="post-card">
        ${p.main_image_url ? `<img src="${p.main_image_url}" alt="${p.title}">` : ''}
        <div class="content">
          <h3><a href="post.html?slug=${p.slug}">${p.title}</a></h3>
          <p>${p.description || ''}</p>
          <div class="meta">
            ${new Date(p.published_at).toLocaleDateString()} ‚Ä¢ üëÅ ${p.views_count} ‚Ä¢ ‚ù§Ô∏è ${p.likes_count}
          </div>
        </div>
      </div>
    `).join('');
  }

  // Sorting
  filterBtns.forEach(btn=>{
    btn.addEventListener('click',()=>{
      filterBtns.forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      currentSort = btn.dataset.sort;
      loadPosts();
    });
  });

  // Tags
  async function loadTags(){
    const tags = await fetchTags();
    tagFilters.innerHTML = tags.map(t=>`
      <button>${t}</button>
    `).join('');
    tagFilters.querySelectorAll('button').forEach(btn=>{
      btn.addEventListener('click',()=>{
        if(currentTag === btn.textContent){
          currentTag = null;
          btn.classList.remove('active');
        } else {
          currentTag = btn.textContent;
          tagFilters.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
        }
        loadPosts();
      });
    });
  }

  loadTags();
  loadPosts();
</script>

<script>
  async function include(file, target){
    const res = await fetch(file);
    document.getElementById(target).innerHTML = await res.text();
  }
  include('../header.html','header');
  include('../footer.html','footer');
</script>
</body>
</html>
